{
  "version": "3.1.0",
  "project": {
    "name": "nestjs-nextjs-template",
    "description": "NestJS + Next.js monorepo with JWT auth, event planner, and comprehensive testing",
    "stack": ["nestjs", "nextjs", "typescript", "nx", "prisma", "postgresql", "jest", "playwright"]
  },
  "tiers": {
    "detection": "self-assess",
    "fallback": 3
  },
  "zones": [
    {
      "id": "api",
      "path": ".add/zones/api.md",
      "languages": ["typescript"],
      "testable": true,
      "confidence": 0.85
    },
    {
      "id": "web",
      "path": ".add/zones/web.md",
      "languages": ["typescript", "tsx"],
      "testable": true,
      "confidence": 0.85
    },
    {
      "id": "database",
      "path": ".add/zones/database.md",
      "languages": ["prisma", "typescript"],
      "testable": true,
      "confidence": 0.9
    }
  ],
  "gotchas": {
    "registry": ".add/gotchas/REGISTRY.md",
    "auto_check": true
  },
  "uncertainty": {
    "staleness_config": ".add/config/staleness.yaml",
    "thresholds": ".add/config/uncertainty-thresholds.yaml"
  },
  "context_budget": {
    "config": ".add/config/context-budget.md",
    "prompt_at_soft_limit": true
  },
  "models": {
    "haiku": {
      "contextBudget": 8000,
      "responseReserve": 4000,
      "suitable": ["simple-tasks", "code-generation", "tests", "documentation"]
    },
    "sonnet": {
      "contextBudget": 16000,
      "responseReserve": 8000,
      "suitable": ["medium-tasks", "refactoring", "debugging", "review"]
    },
    "gemini": {
      "contextBudget": 16000,
      "responseReserve": 8000,
      "suitable": ["medium-tasks", "refactoring", "debugging", "review", "long-context"]
    },
    "opus": {
      "contextBudget": 32000,
      "responseReserve": 16000,
      "suitable": ["complex-tasks", "architecture", "planning", "orchestration"]
    }
  },
  "segments": [
    {
      "name": "core/project",
      "path": "core/project.md",
      "tokens": 1000,
      "priority": "critical",
      "triggers": ["*"],
      "description": "Tech stack, conventions, project structure, key commands"
    },
    {
      "name": "core/agents",
      "path": "core/agents.md",
      "tokens": 400,
      "priority": "critical",
      "triggers": ["*"],
      "description": "Agent roles, handoff protocols, delegation rules"
    },
    {
      "name": "memory/modules/auth",
      "path": "memory/modules/auth.md",
      "tokens": 1500,
      "priority": "normal",
      "triggers": [
        "auth",
        "login",
        "logout",
        "jwt",
        "token",
        "session",
        "guard",
        "passport",
        "register",
        "user"
      ],
      "description": "Authentication module: JWT, Passport, guards, user management"
    },
    {
      "name": "memory/modules/database",
      "path": "memory/modules/database.md",
      "tokens": 1200,
      "priority": "normal",
      "triggers": [
        "database",
        "prisma",
        "postgres",
        "postgresql",
        "entity",
        "migration",
        "schema",
        "model"
      ],
      "description": "Database patterns: Prisma, migrations, schema management"
    },
    {
      "name": "memory/modules/api",
      "path": "memory/modules/api.md",
      "tokens": 1300,
      "priority": "normal",
      "triggers": [
        "api",
        "rest",
        "endpoint",
        "controller",
        "dto",
        "validation",
        "nestjs",
        "swagger",
        "openapi"
      ],
      "description": "API design: Controllers, DTOs, validation, OpenAPI/Swagger"
    },
    {
      "name": "memory/modules/frontend",
      "path": "memory/modules/frontend.md",
      "tokens": 1400,
      "priority": "normal",
      "triggers": [
        "frontend",
        "react",
        "nextjs",
        "component",
        "hook",
        "ui",
        "styling",
        "css",
        "layout"
      ],
      "description": "Frontend patterns: React, Next.js, components, hooks, CSS Modules"
    },
    {
      "name": "memory/modules/testing",
      "path": "memory/modules/testing.md",
      "tokens": 1100,
      "priority": "normal",
      "triggers": ["test", "jest", "e2e", "unit", "mock", "msw", "fixture", "playwright"],
      "description": "Testing strategies: Jest, E2E, MSW, test patterns"
    },
    {
      "name": "memory/modules/events",
      "path": "memory/modules/events.md",
      "tokens": 900,
      "priority": "normal",
      "triggers": ["event", "events", "planner", "calendar", "useevents"],
      "description": "Event planner feature: CRUD operations, calendar picker"
    },
    {
      "name": "memory/modules/security",
      "path": "memory/modules/security.md",
      "tokens": 800,
      "priority": "normal",
      "triggers": [
        "security",
        "helmet",
        "cors",
        "rate-limit",
        "throttle",
        "headers",
        "csp",
        "hsts"
      ],
      "description": "Security: Helmet headers, rate limiting, CORS configuration"
    },
    {
      "name": "memory/modules/error-handling",
      "path": "memory/modules/error-handling.md",
      "tokens": 700,
      "priority": "normal",
      "triggers": ["error", "exception", "filter", "boundary", "correlation", "logging"],
      "description": "Error handling: Global filters, error boundaries, correlation IDs"
    },
    {
      "name": "memory/modules/deployment",
      "path": "memory/modules/deployment.md",
      "tokens": 1800,
      "priority": "normal",
      "triggers": [
        "deploy",
        "deployment",
        "azure",
        "docker",
        "container",
        "ci/cd",
        "infrastructure",
        "production",
        "staging",
        "acr",
        "devops",
        "logs",
        "monitoring"
      ],
      "description": "Deployment: Azure Container Apps, Docker, CI/CD, logging, monitoring"
    },
    {
      "name": "memory/decisions",
      "path": "memory/decisions/",
      "tokens": 1000,
      "priority": "low",
      "triggers": ["adr", "decision", "architecture"],
      "description": "Architecture decision records (ADRs)"
    },
    {
      "name": "session/active",
      "path": "sessions/active/",
      "tokens": 1500,
      "priority": "high",
      "triggers": ["continue", "resume", "session"],
      "description": "Currently active session state"
    }
  ],
  "commands": {
    "develop-feature": {
      "description": "Create or continue developing a feature",
      "segments": ["core/project", "core/agents", "session/active"],
      "dynamicSegments": {
        "strategy": "trigger-match",
        "maxAdditional": 3
      },
      "template": "prompts/entry-points/develop-feature.md",
      "defaultModel": "sonnet",
      "canDelegate": true
    },
    "fix-bug": {
      "description": "Debug and fix an issue",
      "segments": ["core/project", "core/agents", "memory/modules/testing"],
      "dynamicSegments": {
        "strategy": "trigger-match",
        "maxAdditional": 2
      },
      "defaultModel": "sonnet",
      "canDelegate": true
    },
    "refactor": {
      "description": "Refactor code or architecture",
      "segments": ["core/project", "core/agents", "memory/decisions"],
      "dynamicSegments": {
        "strategy": "trigger-match",
        "maxAdditional": 2
      },
      "defaultModel": "opus",
      "canDelegate": false
    },
    "continue": {
      "description": "Resume most recent active session",
      "segments": ["core/project", "core/agents", "session/active"],
      "dynamicSegments": {
        "strategy": "from-session",
        "maxAdditional": 3
      },
      "defaultModel": "sonnet",
      "canDelegate": true
    },
    "status": {
      "description": "Quick status overview",
      "segments": ["core/project"],
      "dynamicSegments": {
        "strategy": "none"
      },
      "defaultModel": "haiku",
      "canDelegate": false
    },
    "handoff": {
      "description": "Delegate task to another model",
      "segments": ["core/project", "core/agents"],
      "dynamicSegments": {
        "strategy": "from-task"
      },
      "defaultModel": "opus",
      "canDelegate": false
    }
  },
  "routing": {
    "triggerMatch": {
      "description": "Match user input against segment triggers",
      "algorithm": "keyword-intersection",
      "minScore": 0.3
    },
    "budgetAllocation": {
      "critical": 1.0,
      "high": 0.8,
      "normal": 0.6,
      "low": 0.3
    }
  },
  "handoff": {
    "compressionStrategy": "summarize-preserve-code",
    "maxHandoffTokens": 4000,
    "includeSuccessCriteria": true,
    "includeRollbackPlan": true
  }
}
